define(["./when-54335d57","./Cartesian2-8646c5a1","./ArcType-2b58731c","./arrayRemoveDuplicates-3fea1e5f","./Transforms-79117a7b","./Color-98c5f877","./ComponentDatatype-1a100acd","./Check-24483042","./GeometryAttribute-374f805d","./GeometryAttributes-caa08d6c","./IndexDatatype-82ceea78","./Math-d6182036","./PolylinePipeline-3803a6c2","./VertexFormat-81ec7207","./RuntimeError-88a32665","./WebGLConstants-95ceb4e9","./EllipsoidGeodesic-cc216670","./EllipsoidRhumbLine-2b7999f3","./IntersectionTests-5394f658","./Plane-13ae4b1b"],function(J,j,K,Q,X,Z,$,e,ee,te,re,ae,oe,y,t,r,a,o,n,i){"use strict";var ne=[];function ie(e,t,r,a,o){var n=ne;n.length=o;var i=r.red,l=r.green,s=r.blue,p=r.alpha,c=a.red,d=a.green,u=a.blue,y=a.alpha;if(Z.Color.equals(r,a)){for(C=0;C<o;C++)n[C]=Z.Color.clone(r);return n}for(var m=(c-i)/o,h=(d-l)/o,f=(u-s)/o,v=(y-p)/o,C=0;C<o;C++)n[C]=new Z.Color(i+C*m,l+C*h,s+C*f,p+C*v);return n}function m(e){var t=(e=J.defaultValue(e,J.defaultValue.EMPTY_OBJECT)).positions,r=e.colors,a=J.defaultValue(e.width,1),o=J.defaultValue(e.colorsPerVertex,!1);this._positions=t,this._colors=r,this._width=a,this._colorsPerVertex=o,this._vertexFormat=y.VertexFormat.clone(J.defaultValue(e.vertexFormat,y.VertexFormat.DEFAULT)),this._arcType=J.defaultValue(e.arcType,K.ArcType.GEODESIC),this._granularity=J.defaultValue(e.granularity,ae.CesiumMath.RADIANS_PER_DEGREE),this._ellipsoid=j.Ellipsoid.clone(J.defaultValue(e.ellipsoid,j.Ellipsoid.WGS84)),this._workerName="createPolylineGeometry";var n=1+t.length*j.Cartesian3.packedLength;n+=J.defined(r)?1+r.length*Z.Color.packedLength:1,this.packedLength=n+j.Ellipsoid.packedLength+y.VertexFormat.packedLength+4}m.pack=function(e,t,r){var a;r=J.defaultValue(r,0);var o=e._positions,n=o.length;for(t[r++]=n,a=0;a<n;++a,r+=j.Cartesian3.packedLength)j.Cartesian3.pack(o[a],t,r);var i=e._colors,n=J.defined(i)?i.length:0;for(t[r++]=n,a=0;a<n;++a,r+=Z.Color.packedLength)Z.Color.pack(i[a],t,r);return j.Ellipsoid.pack(e._ellipsoid,t,r),r+=j.Ellipsoid.packedLength,y.VertexFormat.pack(e._vertexFormat,t,r),r+=y.VertexFormat.packedLength,t[r++]=e._width,t[r++]=e._colorsPerVertex?1:0,t[r++]=e._arcType,t[r]=e._granularity,t};var h=j.Ellipsoid.clone(j.Ellipsoid.UNIT_SPHERE),f=new y.VertexFormat,v={positions:void 0,colors:void 0,ellipsoid:h,vertexFormat:f,width:void 0,colorsPerVertex:void 0,arcType:void 0,granularity:void 0};m.unpack=function(e,t,r){t=J.defaultValue(t,0);for(var a=e[t++],o=new Array(a),n=0;n<a;++n,t+=j.Cartesian3.packedLength)o[n]=j.Cartesian3.unpack(e,t);var i=0<(a=e[t++])?new Array(a):void 0;for(n=0;n<a;++n,t+=Z.Color.packedLength)i[n]=Z.Color.unpack(e,t);var l=j.Ellipsoid.unpack(e,t,h);t+=j.Ellipsoid.packedLength;var s=y.VertexFormat.unpack(e,t,f);t+=y.VertexFormat.packedLength;var p=e[t++],c=1===e[t++],d=e[t++],u=e[t];return J.defined(r)?(r._positions=o,r._colors=i,r._ellipsoid=j.Ellipsoid.clone(l,r._ellipsoid),r._vertexFormat=y.VertexFormat.clone(s,r._vertexFormat),r._width=p,r._colorsPerVertex=c,r._arcType=d,r._granularity=u,r):(v.positions=o,v.colors=i,v.width=p,v.colorsPerVertex=c,v.arcType=d,v.granularity=u,new m(v))};var le=new j.Cartesian3,se=new j.Cartesian3,pe=new j.Cartesian3,ce=new j.Cartesian3;return m.createGeometry=function(e){var t=e._width,r=e._vertexFormat,a=e._colors,o=e._colorsPerVertex,n=e._arcType,i=e._granularity,l=e._ellipsoid,s=Q.arrayRemoveDuplicates(e._positions,j.Cartesian3.equalsEpsilon),p=s.length;if(!(p<2||t<=0)){if(n===K.ArcType.GEODESIC||n===K.ArcType.RHUMB){var c,d=n===K.ArcType.GEODESIC?(c=ae.CesiumMath.chordLength(i,l.maximumRadius),oe.PolylinePipeline.numberOfPoints):(c=i,oe.PolylinePipeline.numberOfPointsRhumbLine),u=oe.PolylinePipeline.extractHeights(s,l);if(J.defined(a)){for(var y=1,m=0;m<p-1;++m)y+=d(s[m],s[m+1],c);var h=new Array(y),f=0;for(m=0;m<p-1;++m){var v=s[m],C=s[m+1],g=a[m],_=d(v,C,c);if(o&&m<y)for(var A=ie(0,0,g,a[m+1],_),E=A.length,P=0;P<E;++P)h[f++]=A[P];else for(P=0;P<_;++P)h[f++]=Z.Color.clone(g)}h[f]=Z.Color.clone(a[a.length-1]),a=h,ne.length=0}s=n===K.ArcType.GEODESIC?oe.PolylinePipeline.generateCartesianArc({positions:s,minDistance:c,ellipsoid:l,height:u}):oe.PolylinePipeline.generateCartesianRhumbArc({positions:s,granularity:c,ellipsoid:l,height:u})}var b,w,T,x=4*(p=s.length)-4,k=new Float64Array(3*x),D=new Float64Array(3*x),V=new Float64Array(3*x),L=new Float32Array(2*x),F=r.st?new Float32Array(2*x):void 0,G=J.defined(a)?new Uint8Array(4*x):void 0,O=0,R=0,I=0,S=0;for(P=0;P<p;++P){0===P?(b=le,j.Cartesian3.subtract(s[0],s[1],b),j.Cartesian3.add(s[0],b,b)):b=s[P-1],j.Cartesian3.clone(b,pe),j.Cartesian3.clone(s[P],se),P===p-1?(b=le,j.Cartesian3.subtract(s[p-1],s[p-2],b),j.Cartesian3.add(s[p-1],b,b)):b=s[P+1],j.Cartesian3.clone(b,ce),J.defined(G)&&(w=0===P||o?a[P]:a[P-1],P!==p-1&&(T=a[P]));for(var B=P===p-1?2:4,U=0===P?2:0;U<B;++U){j.Cartesian3.pack(se,k,O),j.Cartesian3.pack(pe,D,O),j.Cartesian3.pack(ce,V,O),O+=3;var N,M=U-2<0?-1:1;L[R++]=U%2*2-1,L[R++]=M*t,r.st&&(F[I++]=P/(p-1),F[I++]=Math.max(L[R-2],0)),J.defined(G)&&(N=U<2?w:T,G[S++]=Z.Color.floatToByte(N.red),G[S++]=Z.Color.floatToByte(N.green),G[S++]=Z.Color.floatToByte(N.blue),G[S++]=Z.Color.floatToByte(N.alpha))}}var H=new te.GeometryAttributes;H.position=new ee.GeometryAttribute({componentDatatype:$.ComponentDatatype.DOUBLE,componentsPerAttribute:3,values:k}),H.prevPosition=new ee.GeometryAttribute({componentDatatype:$.ComponentDatatype.DOUBLE,componentsPerAttribute:3,values:D}),H.nextPosition=new ee.GeometryAttribute({componentDatatype:$.ComponentDatatype.DOUBLE,componentsPerAttribute:3,values:V}),H.expandAndWidth=new ee.GeometryAttribute({componentDatatype:$.ComponentDatatype.FLOAT,componentsPerAttribute:2,values:L}),r.st&&(H.st=new ee.GeometryAttribute({componentDatatype:$.ComponentDatatype.FLOAT,componentsPerAttribute:2,values:F})),J.defined(G)&&(H.color=new ee.GeometryAttribute({componentDatatype:$.ComponentDatatype.UNSIGNED_BYTE,componentsPerAttribute:4,values:G,normalize:!0}));var W=re.IndexDatatype.createTypedArray(x,6*p-6),Y=0,q=0,z=p-1;for(P=0;P<z;++P)W[q++]=Y,W[q++]=Y+2,W[q++]=Y+1,W[q++]=Y+1,W[q++]=Y+2,W[q++]=Y+3,Y+=4;return new ee.Geometry({attributes:H,indices:W,primitiveType:ee.PrimitiveType.TRIANGLES,boundingSphere:X.BoundingSphere.fromPoints(s),geometryType:ee.GeometryType.POLYLINES})}},function(e,t){return J.defined(t)&&(e=m.unpack(e,t)),e._ellipsoid=j.Ellipsoid.clone(e._ellipsoid),m.createGeometry(e)}});
