define(["./when-54335d57","./Cartesian2-8646c5a1","./ArcType-2b58731c","./GeometryOffsetAttribute-718fa138","./Transforms-79117a7b","./Check-24483042","./ComponentDatatype-1a100acd","./EllipsoidTangentPlane-325a8e68","./GeometryAttribute-374f805d","./GeometryAttributes-caa08d6c","./GeometryInstance-6aa9010a","./GeometryPipeline-571ff4c9","./IndexDatatype-82ceea78","./Math-d6182036","./PolygonGeometryLibrary-2a7648d9","./PolygonPipeline-97a7160d","./RuntimeError-88a32665","./WebGLConstants-95ceb4e9","./IntersectionTests-5394f658","./Plane-13ae4b1b","./AttributeCompression-10c27d9c","./EncodedCartesian3-bf827957","./arrayRemoveDuplicates-3fea1e5f","./EllipsoidRhumbLine-2b7999f3"],function(E,c,v,A,_,e,G,L,T,H,C,O,D,x,I,w,t,i,r,o,n,a,l,s){"use strict";var S=[],k=[];function R(e,t,i,r,o){var n,a=L.EllipsoidTangentPlane.fromPoints(t,e).projectPointsOntoPlane(t,S);w.PolygonPipeline.computeWindingOrder2D(a)===w.WindingOrder.CLOCKWISE&&(a.reverse(),t=t.slice().reverse());var l=t.length,s=0;if(r)for(n=new Float64Array(2*l*3),m=0;m<l;m++){var y=t[m],u=t[(m+1)%l];n[s++]=y.x,n[s++]=y.y,n[s++]=y.z,n[s++]=u.x,n[s++]=u.y,n[s++]=u.z}else{var p,d=0;if(o===v.ArcType.GEODESIC)for(m=0;m<l;m++)d+=I.PolygonGeometryLibrary.subdivideLineCount(t[m],t[(m+1)%l],i);else if(o===v.ArcType.RHUMB)for(m=0;m<l;m++)d+=I.PolygonGeometryLibrary.subdivideRhumbLineCount(e,t[m],t[(m+1)%l],i);for(n=new Float64Array(3*d),m=0;m<l;m++){o===v.ArcType.GEODESIC?p=I.PolygonGeometryLibrary.subdivideLine(t[m],t[(m+1)%l],i,k):o===v.ArcType.RHUMB&&(p=I.PolygonGeometryLibrary.subdivideRhumbLine(e,t[m],t[(m+1)%l],i,k));for(var c=p.length,g=0;g<c;++g)n[s++]=p[g]}}for(var f=2*(l=n.length/3),h=D.IndexDatatype.createTypedArray(l,f),s=0,m=0;m<l-1;m++)h[s++]=m,h[s++]=m+1;return h[s++]=l-1,h[s++]=0,new C.GeometryInstance({geometry:new T.Geometry({attributes:new H.GeometryAttributes({position:new T.GeometryAttribute({componentDatatype:G.ComponentDatatype.DOUBLE,componentsPerAttribute:3,values:n})}),indices:h,primitiveType:T.PrimitiveType.LINES})})}function N(e,t,i,r,o){var n,a=L.EllipsoidTangentPlane.fromPoints(t,e).projectPointsOntoPlane(t,S);w.PolygonPipeline.computeWindingOrder2D(a)===w.WindingOrder.CLOCKWISE&&(a.reverse(),t=t.slice().reverse());var l=t.length,s=new Array(l),y=0;if(r)for(n=new Float64Array(2*l*3*2),P=0;P<l;++P){s[P]=y/3;var u=t[P],p=t[(P+1)%l];n[y++]=u.x,n[y++]=u.y,n[y++]=u.z,n[y++]=p.x,n[y++]=p.y,n[y++]=p.z}else{var d,c=0;if(o===v.ArcType.GEODESIC)for(P=0;P<l;P++)c+=I.PolygonGeometryLibrary.subdivideLineCount(t[P],t[(P+1)%l],i);else if(o===v.ArcType.RHUMB)for(P=0;P<l;P++)c+=I.PolygonGeometryLibrary.subdivideRhumbLineCount(e,t[P],t[(P+1)%l],i);for(n=new Float64Array(3*c*2),P=0;P<l;++P){s[P]=y/3,o===v.ArcType.GEODESIC?d=I.PolygonGeometryLibrary.subdivideLine(t[P],t[(P+1)%l],i,k):o===v.ArcType.RHUMB&&(d=I.PolygonGeometryLibrary.subdivideRhumbLine(e,t[P],t[(P+1)%l],i,k));for(var g=d.length,f=0;f<g;++f)n[y++]=d[f]}}l=n.length/6;for(var h=s.length,m=2*(2*l+h),b=D.IndexDatatype.createTypedArray(l+h,m),y=0,P=0;P<l;++P)b[y++]=P,b[y++]=(P+1)%l,b[y++]=P+l,b[y++]=(P+1)%l+l;for(P=0;P<h;P++){var E=s[P];b[y++]=E,b[y++]=E+l}return new C.GeometryInstance({geometry:new T.Geometry({attributes:new H.GeometryAttributes({position:new T.GeometryAttribute({componentDatatype:G.ComponentDatatype.DOUBLE,componentsPerAttribute:3,values:n})}),indices:b,primitiveType:T.PrimitiveType.LINES})})}function g(e){var t,i=e.polygonHierarchy,r=E.defaultValue(e.ellipsoid,c.Ellipsoid.WGS84),o=E.defaultValue(e.granularity,x.CesiumMath.RADIANS_PER_DEGREE),n=E.defaultValue(e.perPositionHeight,!1),a=n&&E.defined(e.extrudedHeight),l=E.defaultValue(e.arcType,v.ArcType.GEODESIC),s=E.defaultValue(e.height,0),y=E.defaultValue(e.extrudedHeight,s);a||(t=Math.max(s,y),y=Math.min(s,y),s=t),this._ellipsoid=c.Ellipsoid.clone(r),this._granularity=o,this._height=s,this._extrudedHeight=y,this._arcType=l,this._polygonHierarchy=i,this._perPositionHeight=n,this._perPositionHeightExtrude=a,this._offsetAttribute=e.offsetAttribute,this._workerName="createPolygonOutlineGeometry",this.packedLength=I.PolygonGeometryLibrary.computeHierarchyPackedLength(i)+c.Ellipsoid.packedLength+8}g.pack=function(e,t,i){return i=E.defaultValue(i,0),i=I.PolygonGeometryLibrary.packPolygonHierarchy(e._polygonHierarchy,t,i),c.Ellipsoid.pack(e._ellipsoid,t,i),i+=c.Ellipsoid.packedLength,t[i++]=e._height,t[i++]=e._extrudedHeight,t[i++]=e._granularity,t[i++]=e._perPositionHeightExtrude?1:0,t[i++]=e._perPositionHeight?1:0,t[i++]=e._arcType,t[i++]=E.defaultValue(e._offsetAttribute,-1),t[i]=e.packedLength,t};var f=c.Ellipsoid.clone(c.Ellipsoid.UNIT_SPHERE),h={polygonHierarchy:{}};return g.unpack=function(e,t,i){t=E.defaultValue(t,0);var r=I.PolygonGeometryLibrary.unpackPolygonHierarchy(e,t);t=r.startingIndex,delete r.startingIndex;var o=c.Ellipsoid.unpack(e,t,f);t+=c.Ellipsoid.packedLength;var n=e[t++],a=e[t++],l=e[t++],s=1===e[t++],y=1===e[t++],u=e[t++],p=e[t++],d=e[t];return E.defined(i)||(i=new g(h)),i._polygonHierarchy=r,i._ellipsoid=c.Ellipsoid.clone(o,i._ellipsoid),i._height=n,i._extrudedHeight=a,i._granularity=l,i._perPositionHeight=y,i._perPositionHeightExtrude=s,i._arcType=u,i._offsetAttribute=-1===p?void 0:p,i.packedLength=d,i},g.fromPositions=function(e){return new g({polygonHierarchy:{positions:(e=E.defaultValue(e,E.defaultValue.EMPTY_OBJECT)).positions},height:e.height,extrudedHeight:e.extrudedHeight,ellipsoid:e.ellipsoid,granularity:e.granularity,perPositionHeight:e.perPositionHeight,arcType:e.arcType,offsetAttribute:e.offsetAttribute})},g.createGeometry=function(e){var t=e._ellipsoid,i=e._granularity,r=e._polygonHierarchy,o=e._perPositionHeight,n=e._arcType,a=I.PolygonGeometryLibrary.polygonOutlinesFromHierarchy(r,!o,t);if(0!==a.length){var l,s,y,u,p,d,c,g=[],f=x.CesiumMath.chordLength(i,t.maximumRadius),h=e._height,m=e._extrudedHeight;if(e._perPositionHeightExtrude||!x.CesiumMath.equalsEpsilon(h,m,0,x.CesiumMath.EPSILON2))for(l=0;l<a.length;l++){(u=N(t,a[l],f,o,n)).geometry=I.PolygonGeometryLibrary.scaleToGeodeticHeightExtruded(u.geometry,h,m,t,o),E.defined(e._offsetAttribute)&&(s=u.geometry.attributes.position.values.length/3,y=new Uint8Array(s),y=e._offsetAttribute===A.GeometryOffsetAttribute.TOP?A.arrayFill(y,1,0,s/2):(c=e._offsetAttribute===A.GeometryOffsetAttribute.NONE?0:1,A.arrayFill(y,c)),u.geometry.attributes.applyOffset=new T.GeometryAttribute({componentDatatype:G.ComponentDatatype.UNSIGNED_BYTE,componentsPerAttribute:1,values:y})),g.push(u)}else for(l=0;l<a.length;l++){(u=R(t,a[l],f,o,n)).geometry.attributes.position.values=w.PolygonPipeline.scaleToGeodeticHeight(u.geometry.attributes.position.values,h,t,!o),E.defined(e._offsetAttribute)&&(p=u.geometry.attributes.position.values.length,d=new Uint8Array(p/3),c=e._offsetAttribute===A.GeometryOffsetAttribute.NONE?0:1,A.arrayFill(d,c),u.geometry.attributes.applyOffset=new T.GeometryAttribute({componentDatatype:G.ComponentDatatype.UNSIGNED_BYTE,componentsPerAttribute:1,values:d})),g.push(u)}var b=O.GeometryPipeline.combineInstances(g)[0],P=_.BoundingSphere.fromVertices(b.attributes.position.values);return new T.Geometry({attributes:b.attributes,indices:b.indices,primitiveType:b.primitiveType,boundingSphere:P,offsetAttribute:e._offsetAttribute})}},function(e,t){return E.defined(t)&&(e=g.unpack(e,t)),e._ellipsoid=c.Ellipsoid.clone(e._ellipsoid),g.createGeometry(e)}});
